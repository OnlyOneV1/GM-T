import math
import numpy as np
import matplotlib.pyplot as plt

from scipy.fft import fft



def DiscreteFourierTransform(bits):
    n = len(bits)
    X = [0]*n
    for i in range(n):
        X[i] = 2 * int(bits[i]) - 1
    X = fft(X)
    #print(X)
    m = [0]*n
    for i in range(n//2):
        m[i] = math.sqrt((float(X[i])**2))

    count = 0
    T = math.sqrt(2.995732274*n)
    for i in range(n//2):
        if(m[i] < T):
            count += 1
    percentile = float(count)/(n/2) * 100
    N_1 = float(count)
    #print(N_1)
    N_0 = 0.95 * n / 2.0
    #print(N_0)
    d = (N_1 - N_0) / math.sqrt(n / 4.0 * 0.95 * 0.05)
    #print(d)
    p = math.erfc(math.fabs(d) / math.sqrt(2.0))

    success = (p >= 0.01)
    return success, p, None


if __name__ == "__main__":
    # bits = ['1', '0', '0', '0', '0', '0', '0', '1', '0', '1', '0', '0', '0', '1', '1', '1', '0', '1', '1', '1', '1',
    #         '1', '0', '1', '0', '1', '1', '1', '0', '1', '1', '1', '1', '0', '0', '1', '1', '0', '1', '0', '1', '0',
    #         '1', '1', '1', '1', '0', '1', '0', '1', '0', '1', '0', '0', '1', '1', '1', '0', '0', '0', '1',
    #         '1', '0', '1', '1', '0', '0', '0', '0', '1', '1', '1', '1', '0', '0', '0', '0', '0', '0', '1', '1', '1',
    #         '1', '1', '1', '1', '0', '0', '0', '0', '1', '0', '0', '1', '0', '0', '0', '0', '0', '1', '1', '1', '0',
    #         '1', '1', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '1', '1', '1', '0', '1', '0', '0', '1',
    #         '1', '0', '0', '0', '0', '1', '1', '1', '0', '0', '0', '1', '1', '1', '0', '0', '1', '1', '0', '1', '1',
    #         '0', '1', '1', '0', '0', '1', '0', '1', '1', '1', '0', '1', '0', '0', '0', '0', '0', '0', '0', '0', '1',
    #         '1', '0', '1', '1', '0', '0', '0', '1', '0', '0', '1', '1', '1', '1', '1', '1', '0', '0', '1', '1', '0',
    #         '0',
    #         '0', '1', '0', '1', '0', '0', '1', '0', '0', '0', '1', '1', '0', '1', '0', '0', '0', '1', '0', '0', '0',
    #         '0', '0', '0', '1', '0', '1', '1', '1', '0', '0', '0', '1', '1', '0', '1', '0', '0', '0', '0', '0', '1',
    #         '1', '1', '0', '0', '1', '0', '1', '0', '1', '1', '0', '0', '0', '1', '0', '1', '1', '0', '1', '1', '1',
    #         '1', '0']
    bits='1100100100001111110110101010001000100001011010001100001000110100110001001100011001100010100010111000'
    bits=list(bits)
    s1, s2, s3 = DiscreteFourierTransform(bits)
    if s1 == True:
        print("通过检测,p value is %s" % s2)
    else:
        print("未通过检测")























