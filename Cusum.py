import math

def normcdf(n):
    return 0.5 * math.erfc(-n * math.sqrt(0.5))

def Cusum(bits):
    n = len(bits)

    for i in range(n):
        bits[i] = int(bits[i])*2-1
    sum = [0]*n

    count = 0
    for j in range(n):
        count += bits[j]
        sum[j] = count
    #print(sum)
    z = max(sum)
    print(z)
    sum1 = 0.0
    sum2 = 0.0
    a = int(math.floor((((float(n)/z)-1.0)/4.0))) #((n//z)-1)//4
    b = int(math.floor((((float(-n)/z)+1.0)/4.0)))#(-n//z+1)//4
    c = int(math.floor((((float(-n)/z)-3.0)/4.0)))#(-n//z-3)//4
    for k in range(b,a+1):
        d = ((4.0*k+1.0)*z)/math.sqrt(n)
        sum1 += normcdf(d)
        e = ((4.0*k-1.0)*z)/math.sqrt(n)
        sum1 -= normcdf(e)

    for k in range(c,a+1):
        c = ((4.0*k+3.0)*z)/math.sqrt(n)
        sum2 += normcdf(c)
        e = ((4.0*k+1.0)*z)/math.sqrt(n)
        sum2 -= normcdf(e)
            #st.norm.cdf(((4*k-1)*z)/math.sqrt(n))


    p = 1.0 - sum1 + sum2
    success = (p >= 0.01)
    return success, p, None

def change(bits):
    new_bits = []
    n = 10**6
    N = int(n/len(bits))
    for i in range(N):
        new_bits += bits
    m = n - N*len(bits)
    new_bits += bits[:m]
    return new_bits

if __name__ == "__main__":
    bits = ['1', '0', '0', '0', '0', '0', '0', '1', '0', '1', '0', '0', '0', '1', '1', '1', '0', '1', '1', '1', '1',
            '1', '0', '1', '0', '1', '1', '1', '0', '1', '1', '1', '1', '0', '0', '1', '1', '0', '1', '0', '1', '0',
            '1', '1', '1', '1', '0', '1', '0', '1', '0', '1', '0', '0', '1', '1', '1', '0', '0', '0', '1',
            '1', '0', '1', '1', '0', '0', '0', '0', '1', '1', '1', '1', '0', '0', '0', '0', '0', '0', '1', '1', '1',
            '1', '1', '1', '1', '0', '0', '0', '0', '1', '0', '0', '1', '0', '0', '0', '0', '0', '1', '1', '1', '0',
            '1', '1', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '1', '1', '1', '0', '1', '0', '0', '1',
            '1', '0', '0', '0', '0', '1', '1', '1', '0', '0', '0', '1', '1', '1', '0', '0', '1', '1', '0', '1', '1',
            '0', '1', '1', '0', '0', '1', '0', '1', '1', '1', '0', '1', '0', '0', '0', '0', '0', '0', '0', '0', '1',
            '1', '0', '1', '1', '0', '0', '0', '1', '0', '0', '1', '1', '1', '1', '1', '1', '0', '0', '1', '1', '0',
            '0',
            '0', '1', '0', '1', '0', '0', '1', '0', '0', '0', '1', '1', '0', '1', '0', '0', '0', '1', '0', '0', '0',
            '0', '0', '0', '1', '0', '1', '1', '1', '0', '0', '0', '1', '1', '0', '1', '0', '0', '0', '0', '0', '1',
            '1', '1', '0', '0', '1', '0', '1', '0', '1', '1', '0', '0', '0', '1', '0', '1', '1', '0', '1', '1', '1',
            '1', '0']
    # bits='1011010111'
    # bits=list(bits)
    bits = change(bits)
    s1, s2, s3 = Cusum(bits)
    if s1 == True:
        print("通过检测,p value is %s" % s2)
    else:
        print("未通过检测")