import math
from scipy.special import gamma, gammainc, gammaincc

def change(n,m):
    if len(n) < m:
        r = '0'*(m-len(n)) + n
    else:
        r = n
    return r

def poker(bits):
    n = len(bits)
    M = 8
    N = int(math.floor(n / M))

    line = []
    for i in range(N):
        block = bits[i * (M):((i + 1) * (M))]
        s="".join(block)
        line.append(s)

    key = 2**M
    res = [0]*key
    for j in range(key):
        r = bin(j).replace('0b', '')
        r = change(r,M)
        res[j] = line.count(r)
    #print(res)
    res_sum = 0
    for m in range(key):
        res_sum += res[m] ** 2

    v = float(2**M)/float(N) * res_sum -N
    #print(v)
    p = gammainc((2**M - 1)/ 2.0, v/2.0)
    #print(p)
    success = (p >= 0.01)
    return success, p, None


if __name__ == "__main__":
    bits = ['1', '0', '0', '0', '0', '0', '0', '1', '0', '1', '0', '0', '0', '1', '1', '1', '0', '1', '1', '1', '1',
            '1', '0', '1', '0', '1', '1', '1', '0', '1', '1', '1', '1', '0', '0', '1', '1', '0', '1', '0', '1', '0',
            '1', '1', '1', '1', '0', '1', '0', '1', '0', '1', '0', '0', '1', '1', '1', '0', '0', '0', '1',
            '1', '0', '1', '1', '0', '0', '0', '0', '1', '1', '1', '1', '0', '0', '0', '0', '0', '0', '1', '1', '1',
            '1', '1', '1', '1', '0', '0', '0', '0', '1', '0', '0', '1', '0', '0', '0', '0', '0', '1', '1', '1', '0',
            '1', '1', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '1', '1', '1', '0', '1', '0', '0', '1',
            '1', '0', '0', '0', '0', '1', '1', '1', '0', '0', '0', '1', '1', '1', '0', '0', '1', '1', '0', '1', '1',
            '0', '1', '1', '0', '0', '1', '0', '1', '1', '1', '0', '1', '0', '0', '0', '0', '0', '0', '0', '0', '1',
            '1', '0', '1', '1', '0', '0', '0', '1', '0', '0', '1', '1', '1', '1', '1', '1', '0', '0', '1', '1', '0',
            '0',
            '0', '1', '0', '1', '0', '0', '1', '0', '0', '0', '1', '1', '0', '1', '0', '0', '0', '1', '0', '0', '0',
            '0', '0', '0', '1', '0', '1', '1', '1', '0', '0', '0', '1', '1', '0', '1', '0', '0', '0', '0', '0', '1',
            '1', '1', '0', '0', '1', '0', '1', '0', '1', '1', '0', '0', '0', '1', '0', '1', '1', '0', '1', '1', '1',
            '1', '0']
    # bits='10100100101110010110'
    # bits = list(bits)
    s1, s2, s3 = poker(bits)
    if s1 == True:
        print("通过检测,p value is %s" % s2)
    else:
        print("未通过检测")
